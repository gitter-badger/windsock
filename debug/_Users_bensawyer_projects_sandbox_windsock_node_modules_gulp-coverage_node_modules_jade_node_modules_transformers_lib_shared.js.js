
// Instrumentation Header
{
    var fs = require('fs');
    var __statement_QkwBao, __expression_IwF0Yc, __block_sdWnWP;
    var store = require('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/contrib/coverage_store.js');
    
    __statement_QkwBao = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/lib/shared.js');
        fs.writeSync(fd, '{"statement": {"node": ' + i + '}},\n');
    }; 
    
    __expression_IwF0Yc = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/lib/shared.js');
        fs.writeSync(fd, '{"expression": {"node": ' + i + '}},\n');
    }; 
    
    __block_sdWnWP = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/lib/shared.js');
        fs.writeSync(fd, '{"block": ' + i + '},\n');
    }; 
    __intro_VqHNSO = function(id, obj) {
        // console.log('__intro: ', id, ', obj.__instrumented_miss: ', obj.__instrumented_miss, ', obj.length: ', obj.length);
        (typeof obj === 'object' || typeof obj === 'function') &&
            Object.defineProperty && Object.defineProperty(obj, '__instrumented_miss', {enumerable: false, writable: true});
        obj.__instrumented_miss = obj.__instrumented_miss || [];
        if ('undefined' !== typeof obj && null !== obj && 'undefined' !== typeof obj.__instrumented_miss) {
            if (obj.length === 0) {
                // console.log('interim miss: ', id);
                obj.__instrumented_miss[id] = true;
            } else {
                obj.__instrumented_miss[id] = false;
            }
        }
        return obj;
    };
    function isProbablyChainable(obj, id) {
        return obj &&
            obj.__instrumented_miss[id] !== undefined &&
            'number' === typeof obj.length;
    }
    __extro_TSjc7v = function(id, obj) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/lib/shared.js');
        // console.log('__extro: ', id, ', obj.__instrumented_miss: ', obj.__instrumented_miss, ', obj.length: ', obj.length);
        if ('undefined' !== typeof obj && null !== obj && 'undefined' !== typeof obj.__instrumented_miss) {
            if (isProbablyChainable(obj, id) && obj.length === 0 && obj.__instrumented_miss[id]) {
                // if the call was not a "constructor" - i.e. it did not add things to the chainable
                // and it did not return anything from the chainable, it is a miss
                // console.log('miss: ', id);
            } else {
                fs.writeSync(fd, '{"chain": {"node": ' + id + '}},\n');
            }
            obj.__instrumented_miss[id] = undefined;
        } else {
            fs.writeSync(fd, '{"chain": {"node": ' + id + '}},\n');
        }
        return obj;
    };
};
////////////////////////

// Instrumented Code
{
    __statement_QkwBao(0);
    var Promise = (__expression_IwF0Yc(1), require('promise'));
}
{
    __statement_QkwBao(2);
    var fs = (__expression_IwF0Yc(3), require('fs'));
}
{
    __statement_QkwBao(4);
    var path = (__expression_IwF0Yc(5), require('path'));
}
{
    __statement_QkwBao(6);
    var normalize = path.normalize;
}
{
    __statement_QkwBao(7);
    Promise.prototype.nodeify = function (cb) {
        __block_sdWnWP(0);
        if (__expression_IwF0Yc(8), (__expression_IwF0Yc(9), typeof cb) === 'function') {
            __block_sdWnWP(1);
            {
                __statement_QkwBao(10);
                __extro_TSjc7v(11, __intro_VqHNSO(11, this).then(function (res) {
                    __block_sdWnWP(2);
                    {
                        __statement_QkwBao(12);
                        __extro_TSjc7v(13, __intro_VqHNSO(13, process).nextTick(function () {
                            __block_sdWnWP(3);
                            {
                                __statement_QkwBao(14);
                                __expression_IwF0Yc(15), cb(null, res);
                            }
                        }));
                    }
                }, function (err) {
                    __block_sdWnWP(4);
                    {
                        __statement_QkwBao(16);
                        __extro_TSjc7v(17, __intro_VqHNSO(17, process).nextTick(function () {
                            __block_sdWnWP(5);
                            {
                                __statement_QkwBao(18);
                                __expression_IwF0Yc(19), cb(err);
                            }
                        }));
                    }
                }));
            }
            return __expression_IwF0Yc(20), undefined;
        } else {
            __block_sdWnWP(6);
            return __expression_IwF0Yc(21), this;
        }
    };
}
{
    __statement_QkwBao(22);
    var minifiers = {};
}
{
    __statement_QkwBao(23);
    module.exports = Transformer;
}
function Transformer(obj) {
    __block_sdWnWP(7);
    {
        __statement_QkwBao(24);
        this.name = obj.name;
    }
    {
        __statement_QkwBao(25);
        this.engines = obj.engines;
    }
    {
        __statement_QkwBao(26);
        this.isBinary = (__expression_IwF0Yc(27), obj.isBinary || false);
    }
    {
        __statement_QkwBao(28);
        this.isMinifier = (__expression_IwF0Yc(29), obj.isMinifier || false);
    }
    {
        __statement_QkwBao(30);
        this.outputFormat = obj.outputFormat;
    }
    {
        __statement_QkwBao(31);
        this._cache = {};
    }
    if (__expression_IwF0Yc(32), (__expression_IwF0Yc(33), typeof obj.async) === 'function') {
        __block_sdWnWP(8);
        {
            __statement_QkwBao(34);
            this._renderAsync = obj.async;
        }
        {
            __statement_QkwBao(35);
            this.sudoSync = (__expression_IwF0Yc(36), obj.sudoSync || false);
        }
    }
    if (__expression_IwF0Yc(37), (__expression_IwF0Yc(38), typeof obj.sync) === 'function') {
        __block_sdWnWP(9);
        {
            __statement_QkwBao(39);
            this._renderSync = obj.sync;
        }
        {
            __statement_QkwBao(40);
            this.sync = true;
        }
    } else {
        __block_sdWnWP(10);
        {
            __statement_QkwBao(41);
            this.sync = (__expression_IwF0Yc(42), obj.sudoSync || false);
        }
    }
    if (this.isMinifier) {
        __block_sdWnWP(11);
        {
            __statement_QkwBao(43);
            minifiers[this.outputFormat] = this;
        }
    } else {
        __block_sdWnWP(12);
        {
            __statement_QkwBao(44);
            var minifier = minifiers[this.outputFormat];
        }
        if (__expression_IwF0Yc(45), minifier) {
            __block_sdWnWP(13);
            {
                __statement_QkwBao(46);
                this.minify = function (str, options) {
                    __block_sdWnWP(14);
                    if (__expression_IwF0Yc(47), (__expression_IwF0Yc(48), options) && options.minify) {
                        __block_sdWnWP(15);
                        return __expression_IwF0Yc(49), __extro_TSjc7v(50, __intro_VqHNSO(50, minifier).renderSync(str, (__expression_IwF0Yc(51), (__expression_IwF0Yc(52), (__expression_IwF0Yc(53), (__expression_IwF0Yc(54), typeof options.minify) === 'object') && options.minify) || {})));
                    }
                    return __expression_IwF0Yc(55), str;
                };
            }
        }
    }
}
{
    __statement_QkwBao(56);
    Transformer.prototype.cache = function (options, data) {
        __block_sdWnWP(16);
        if (__expression_IwF0Yc(57), options.cache && options.filename) {
            __block_sdWnWP(17);
            if (__expression_IwF0Yc(58), data) {
                __block_sdWnWP(18);
                return __expression_IwF0Yc(59), this.cache[options.filename] = data;
            } else {
                __block_sdWnWP(19);
                return __expression_IwF0Yc(60), this.cache[options.filename];
            }
        } else {
            __block_sdWnWP(20);
            return __expression_IwF0Yc(61), data;
        }
    };
}
{
    __statement_QkwBao(62);
    Transformer.prototype.loadModule = function () {
        __block_sdWnWP(21);
        if (this.engine) {
            __block_sdWnWP(22);
            return __expression_IwF0Yc(63), this.engine;
        }
        for (var i = 0; __expression_IwF0Yc(64), (__expression_IwF0Yc(65), i) < this.engines.length; __expression_IwF0Yc(66), i++) {
            __block_sdWnWP(23);
            try {
                __block_sdWnWP(24);
                {
                    __statement_QkwBao(67);
                    var res = (__expression_IwF0Yc(70), this.engines[i] === '.') ? (__expression_IwF0Yc(68), null) : (__expression_IwF0Yc(69), this.engine = (__expression_IwF0Yc(71), require(this.engines[i])));
                }
                {
                    __statement_QkwBao(72);
                    this.engineName = this.engines[i];
                }
                return __expression_IwF0Yc(73), res;
            } catch (ex) {
                __block_sdWnWP(25);
                if (__expression_IwF0Yc(74), this.engines.length === 1) {
                    __block_sdWnWP(26);
                    {
                        __statement_QkwBao(75);
                        throw ex;
                    }
                }
            }
        }
        {
            __statement_QkwBao(76);
            throw new Error((__expression_IwF0Yc(77), (__expression_IwF0Yc(78), (__expression_IwF0Yc(79), 'In order to apply the transform ' + this.name) + ' you must install one of ') + __extro_TSjc7v(80, __intro_VqHNSO(80, __extro_TSjc7v(81, __intro_VqHNSO(81, this.engines).map(function (e) {
                __block_sdWnWP(27);
                return __expression_IwF0Yc(82), (__expression_IwF0Yc(83), (__expression_IwF0Yc(84), '"' + (__expression_IwF0Yc(85), e)) + '"');
            }))).join())));
        }
    };
}
{
    __statement_QkwBao(86);
    Transformer.prototype.minify = function (str, options) {
        __block_sdWnWP(28);
        return __expression_IwF0Yc(87), str;
    };
}
{
    __statement_QkwBao(88);
    Transformer.prototype.renderSync = function (str, options) {
        __block_sdWnWP(29);
        {
            __statement_QkwBao(89);
            options = (__expression_IwF0Yc(90), (__expression_IwF0Yc(91), options) || {});
        }
        {
            __statement_QkwBao(92);
            options = (__expression_IwF0Yc(93), clone(options));
        }
        {
            __statement_QkwBao(94);
            __extro_TSjc7v(95, __intro_VqHNSO(95, this).loadModule());
        }
        if (this._renderSync) {
            __block_sdWnWP(30);
            return __expression_IwF0Yc(96), __extro_TSjc7v(97, __intro_VqHNSO(97, this).minify(__extro_TSjc7v(98, __intro_VqHNSO(98, this)._renderSync(this.isBinary ? (__expression_IwF0Yc(99), str) : (__expression_IwF0Yc(100), (__expression_IwF0Yc(101), fixString(str))), options)), options));
        } else if (this.sudoSync) {
            __block_sdWnWP(31);
            {
                __statement_QkwBao(102);
                options.sudoSync = true;
            }
            {
                __statement_QkwBao(103);
                var res, err;
            }
            {
                __statement_QkwBao(104);
                __extro_TSjc7v(105, __intro_VqHNSO(105, this)._renderAsync(this.isBinary ? (__expression_IwF0Yc(106), str) : (__expression_IwF0Yc(107), (__expression_IwF0Yc(108), fixString(str))), options, function (e, val) {
                    __block_sdWnWP(32);
                    if (__expression_IwF0Yc(109), e) {
                        __block_sdWnWP(33);
                        {
                            __statement_QkwBao(110);
                            err = e;
                        }
                    } else {
                        __block_sdWnWP(34);
                        {
                            __statement_QkwBao(111);
                            res = val;
                        }
                    }
                }));
            }
            if (__expression_IwF0Yc(112), err) {
                __block_sdWnWP(35);
                {
                    __statement_QkwBao(113);
                    throw err;
                }
            } else if (__expression_IwF0Yc(114), (__expression_IwF0Yc(115), res) != (__expression_IwF0Yc(116), undefined)) {
                __block_sdWnWP(36);
                return __expression_IwF0Yc(117), __extro_TSjc7v(118, __intro_VqHNSO(118, this).minify(res, options));
            } else if (__expression_IwF0Yc(119), (__expression_IwF0Yc(120), typeof this.sudoSync) === 'string') {
                __block_sdWnWP(37);
                {
                    __statement_QkwBao(121);
                    throw new Error(__extro_TSjc7v(122, __intro_VqHNSO(122, this.sudoSync).replace(/FILENAME/g, (__expression_IwF0Yc(123), options.filename || ''))));
                }
            } else {
                __block_sdWnWP(38);
                {
                    __statement_QkwBao(124);
                    throw new Error((__expression_IwF0Yc(125), (__expression_IwF0Yc(126), (__expression_IwF0Yc(127), 'There was a problem transforming ' + (__expression_IwF0Yc(128), options.filename || '')) + ' syncronously using ') + this.name));
                }
            }
        } else {
            __block_sdWnWP(39);
            {
                __statement_QkwBao(129);
                throw new Error((__expression_IwF0Yc(130), this.name + ' does not support transforming syncronously.'));
            }
        }
    };
}
{
    __statement_QkwBao(131);
    Transformer.prototype.render = function (str, options, cb) {
        __block_sdWnWP(40);
        {
            __statement_QkwBao(132);
            options = (__expression_IwF0Yc(133), (__expression_IwF0Yc(134), options) || {});
        }
        {
            __statement_QkwBao(135);
            var self = this;
        }
        return __expression_IwF0Yc(136), __extro_TSjc7v(137, __intro_VqHNSO(137, new Promise(function (resolve, reject) {
            __block_sdWnWP(41);
            {
                __statement_QkwBao(138);
                __extro_TSjc7v(139, __intro_VqHNSO(139, self).loadModule());
            }
            if (self._renderAsync) {
                __block_sdWnWP(42);
                {
                    __statement_QkwBao(140);
                    __extro_TSjc7v(141, __intro_VqHNSO(141, self)._renderAsync(self.isBinary ? (__expression_IwF0Yc(142), str) : (__expression_IwF0Yc(143), (__expression_IwF0Yc(144), fixString(str))), (__expression_IwF0Yc(145), clone(options)), function (err, val) {
                        __block_sdWnWP(43);
                        if (__expression_IwF0Yc(146), err) {
                            __block_sdWnWP(44);
                            {
                                __statement_QkwBao(147);
                                __expression_IwF0Yc(148), reject(err);
                            }
                        } else {
                            __block_sdWnWP(45);
                            {
                                __statement_QkwBao(149);
                                __expression_IwF0Yc(150), resolve(__extro_TSjc7v(151, __intro_VqHNSO(151, self).minify(val, options)));
                            }
                        }
                    }));
                }
            } else {
                __block_sdWnWP(46);
                {
                    __statement_QkwBao(152);
                    __expression_IwF0Yc(153), resolve(__extro_TSjc7v(154, __intro_VqHNSO(154, self).renderSync(str, options)));
                }
            }
        })).nodeify(cb));
    };
}
{
    __statement_QkwBao(155);
    Transformer.prototype.renderFile = function (path, options, cb) {
        __block_sdWnWP(47);
        {
            __statement_QkwBao(156);
            options = (__expression_IwF0Yc(157), (__expression_IwF0Yc(158), options) || {});
        }
        {
            __statement_QkwBao(159);
            var self = this;
        }
        return __expression_IwF0Yc(160), __extro_TSjc7v(161, __intro_VqHNSO(161, __extro_TSjc7v(162, __intro_VqHNSO(162, new Promise(function (resolve, reject) {
            __block_sdWnWP(48);
            {
                __statement_QkwBao(163);
                options.filename = path = (__expression_IwF0Yc(164), normalize(path));
            }
            if (self._cache[path]) {
                __block_sdWnWP(49);
                {
                    __statement_QkwBao(165);
                    __expression_IwF0Yc(166), resolve(null);
                }
            } else {
                __block_sdWnWP(50);
                {
                    __statement_QkwBao(167);
                    __extro_TSjc7v(168, __intro_VqHNSO(168, fs).readFile(path, function (err, data) {
                        __block_sdWnWP(51);
                        if (__expression_IwF0Yc(169), err) {
                            __block_sdWnWP(52);
                            {
                                __statement_QkwBao(170);
                                __expression_IwF0Yc(171), reject(err);
                            }
                        } else {
                            __block_sdWnWP(53);
                            {
                                __statement_QkwBao(172);
                                __expression_IwF0Yc(173), resolve(data);
                            }
                        }
                    }));
                }
            }
        })).then(function (str) {
            __block_sdWnWP(54);
            return __expression_IwF0Yc(174), __extro_TSjc7v(175, __intro_VqHNSO(175, self).render(str, options));
        }))).nodeify(cb));
    };
}
{
    __statement_QkwBao(176);
    Transformer.prototype.renderFileSync = function (path, options) {
        __block_sdWnWP(55);
        {
            __statement_QkwBao(177);
            options = (__expression_IwF0Yc(178), (__expression_IwF0Yc(179), options) || {});
        }
        {
            __statement_QkwBao(180);
            options.filename = path = (__expression_IwF0Yc(181), normalize(path));
        }
        return __expression_IwF0Yc(182), __extro_TSjc7v(183, __intro_VqHNSO(183, this).renderSync(this._cache[path] ? (__expression_IwF0Yc(184), null) : (__expression_IwF0Yc(185), __extro_TSjc7v(186, __intro_VqHNSO(186, fs).readFileSync(path))), options));
    };
}
function fixString(str) {
    __block_sdWnWP(56);
    if (__expression_IwF0Yc(187), (__expression_IwF0Yc(188), str) == null) {
        __block_sdWnWP(57);
        return __expression_IwF0Yc(189), str;
    }
    {
        __statement_QkwBao(190);
        str = __extro_TSjc7v(191, __intro_VqHNSO(191, str).toString());
    }
    {
        __statement_QkwBao(192);
        str = (__expression_IwF0Yc(195), 65279 == __extro_TSjc7v(196, __intro_VqHNSO(196, str).charCodeAt(0))) ? (__expression_IwF0Yc(193), __extro_TSjc7v(197, __intro_VqHNSO(197, str).substring(1))) : (__expression_IwF0Yc(194), str);
    }
    return __expression_IwF0Yc(198), __extro_TSjc7v(199, __intro_VqHNSO(199, str).replace(/\r/g, ''));
}
function clone(obj) {
    __block_sdWnWP(58);
    if (__extro_TSjc7v(200, __intro_VqHNSO(200, Array).isArray(obj))) {
        __block_sdWnWP(59);
        return __expression_IwF0Yc(201), __extro_TSjc7v(202, __intro_VqHNSO(202, obj).map(clone));
    } else if (__expression_IwF0Yc(203), (__expression_IwF0Yc(204), obj) && (__expression_IwF0Yc(205), (__expression_IwF0Yc(206), typeof obj) === 'object')) {
        __block_sdWnWP(60);
        {
            __statement_QkwBao(207);
            var res = {};
        }
        for (var key in obj) {
            __block_sdWnWP(61);
            {
                __statement_QkwBao(208);
                res[key] = (__expression_IwF0Yc(209), clone(obj[key]));
            }
        }
        return __expression_IwF0Yc(210), res;
    } else {
        __block_sdWnWP(62);
        return __expression_IwF0Yc(211), obj;
    }
}