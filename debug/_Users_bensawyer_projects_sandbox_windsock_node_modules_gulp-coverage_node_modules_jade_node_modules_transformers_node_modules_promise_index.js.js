
// Instrumentation Header
{
    var fs = require('fs');
    var __statement_SCul9N, __expression_G8YRdZ, __block_UoZ4jm;
    var store = require('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/contrib/coverage_store.js');
    
    __statement_SCul9N = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/node_modules/promise/index.js');
        fs.writeSync(fd, '{"statement": {"node": ' + i + '}},\n');
    }; 
    
    __expression_G8YRdZ = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/node_modules/promise/index.js');
        fs.writeSync(fd, '{"expression": {"node": ' + i + '}},\n');
    }; 
    
    __block_UoZ4jm = function(i) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/node_modules/promise/index.js');
        fs.writeSync(fd, '{"block": ' + i + '},\n');
    }; 
    __intro_xH$3OO = function(id, obj) {
        // console.log('__intro: ', id, ', obj.__instrumented_miss: ', obj.__instrumented_miss, ', obj.length: ', obj.length);
        (typeof obj === 'object' || typeof obj === 'function') &&
            Object.defineProperty && Object.defineProperty(obj, '__instrumented_miss', {enumerable: false, writable: true});
        obj.__instrumented_miss = obj.__instrumented_miss || [];
        if ('undefined' !== typeof obj && null !== obj && 'undefined' !== typeof obj.__instrumented_miss) {
            if (obj.length === 0) {
                // console.log('interim miss: ', id);
                obj.__instrumented_miss[id] = true;
            } else {
                obj.__instrumented_miss[id] = false;
            }
        }
        return obj;
    };
    function isProbablyChainable(obj, id) {
        return obj &&
            obj.__instrumented_miss[id] !== undefined &&
            'number' === typeof obj.length;
    }
    __extro_$SX98G = function(id, obj) {
        var fd = store.register('/Users/bensawyer/projects/sandbox/windsock/node_modules/gulp-coverage/node_modules/jade/node_modules/transformers/node_modules/promise/index.js');
        // console.log('__extro: ', id, ', obj.__instrumented_miss: ', obj.__instrumented_miss, ', obj.length: ', obj.length);
        if ('undefined' !== typeof obj && null !== obj && 'undefined' !== typeof obj.__instrumented_miss) {
            if (isProbablyChainable(obj, id) && obj.length === 0 && obj.__instrumented_miss[id]) {
                // if the call was not a "constructor" - i.e. it did not add things to the chainable
                // and it did not return anything from the chainable, it is a miss
                // console.log('miss: ', id);
            } else {
                fs.writeSync(fd, '{"chain": {"node": ' + id + '}},\n');
            }
            obj.__instrumented_miss[id] = undefined;
        } else {
            fs.writeSync(fd, '{"chain": {"node": ' + id + '}},\n');
        }
        return obj;
    };
};
////////////////////////

// Instrumented Code
{
    __statement_SCul9N(0);
    var isPromise = (__expression_G8YRdZ(1), require('is-promise'));
}
{
    __statement_SCul9N(2);
    var nextTick;
}
if (__expression_G8YRdZ(3), (__expression_G8YRdZ(4), typeof setImediate) === 'function') {
    __block_UoZ4jm(0);
    {
        __statement_SCul9N(5);
        nextTick = setImediate;
    }
} else if (__expression_G8YRdZ(6), (__expression_G8YRdZ(7), (__expression_G8YRdZ(8), (__expression_G8YRdZ(9), typeof process) === 'object') && (__expression_G8YRdZ(10), process)) && process.nextTick) {
    __block_UoZ4jm(1);
    {
        __statement_SCul9N(11);
        nextTick = process.nextTick;
    }
} else {
    __block_UoZ4jm(2);
    {
        __statement_SCul9N(12);
        nextTick = function (cb) {
            __block_UoZ4jm(3);
            {
                __statement_SCul9N(13);
                __expression_G8YRdZ(14), setTimeout(cb, 0);
            }
        };
    }
}
{
    __statement_SCul9N(15);
    var extensions = [];
}
{
    __statement_SCul9N(16);
    module.exports = Promise;
}
function Promise(fn) {
    __block_UoZ4jm(4);
    if (__expression_G8YRdZ(17), !(__expression_G8YRdZ(18), this instanceof (__expression_G8YRdZ(19), Promise))) {
        __block_UoZ4jm(5);
        return __expression_G8YRdZ(20), (__expression_G8YRdZ(23), fn) ? (__expression_G8YRdZ(21), new Promise(fn)) : (__expression_G8YRdZ(22), (__expression_G8YRdZ(24), defer()));
    }
    if (__expression_G8YRdZ(25), (__expression_G8YRdZ(26), typeof fn) !== 'function') {
        __block_UoZ4jm(6);
        {
            __statement_SCul9N(27);
            throw new TypeError('fn is not a function');
        }
    }
    {
        __statement_SCul9N(28);
        var state = {
                isResolved: false,
                isSettled: false,
                isFulfilled: false,
                value: null,
                waiting: [],
                running: false
            };
    }
    function _resolve(val) {
        __block_UoZ4jm(7);
        {
            __statement_SCul9N(29);
            __expression_G8YRdZ(30), resolve(state, val);
        }
    }
    function _reject(err) {
        __block_UoZ4jm(8);
        {
            __statement_SCul9N(31);
            __expression_G8YRdZ(32), reject(state, err);
        }
    }
    {
        __statement_SCul9N(33);
        this.then = function _then(onFulfilled, onRejected) {
            __block_UoZ4jm(9);
            return __expression_G8YRdZ(34), (__expression_G8YRdZ(35), then(state, onFulfilled, onRejected));
        };
    }
    {
        __statement_SCul9N(36);
        _resolve.fulfill = (__expression_G8YRdZ(37), deprecate(_resolve, 'resolver.fulfill(x)', 'resolve(x)'));
    }
    {
        __statement_SCul9N(38);
        _resolve.reject = (__expression_G8YRdZ(39), deprecate(_reject, 'resolver.reject', 'reject(x)'));
    }
    try {
        __block_UoZ4jm(10);
        {
            __statement_SCul9N(40);
            __expression_G8YRdZ(41), fn(_resolve, _reject);
        }
    } catch (ex) {
        __block_UoZ4jm(11);
        {
            __statement_SCul9N(42);
            __expression_G8YRdZ(43), _reject(ex);
        }
    }
}
function resolve(promiseState, value) {
    __block_UoZ4jm(12);
    if (promiseState.isResolved) {
        __block_UoZ4jm(13);
        return __expression_G8YRdZ(44);
    }
    if (__expression_G8YRdZ(45), isPromise(value)) {
        __block_UoZ4jm(14);
        {
            __statement_SCul9N(46);
            __expression_G8YRdZ(47), assimilate(promiseState, value);
        }
    } else {
        __block_UoZ4jm(15);
        {
            __statement_SCul9N(48);
            __expression_G8YRdZ(49), settle(promiseState, true, value);
        }
    }
}
function reject(promiseState, reason) {
    __block_UoZ4jm(16);
    if (promiseState.isResolved) {
        __block_UoZ4jm(17);
        return __expression_G8YRdZ(50);
    }
    {
        __statement_SCul9N(51);
        __expression_G8YRdZ(52), settle(promiseState, false, reason);
    }
}
function then(promiseState, onFulfilled, onRejected) {
    __block_UoZ4jm(18);
    return __expression_G8YRdZ(53), new Promise(function (resolve, reject) {
        __block_UoZ4jm(19);
        function done(next, skipTimeout) {
            __block_UoZ4jm(20);
            {
                __statement_SCul9N(54);
                var callback = promiseState.isFulfilled ? (__expression_G8YRdZ(55), onFulfilled) : (__expression_G8YRdZ(56), onRejected);
            }
            if (__expression_G8YRdZ(57), (__expression_G8YRdZ(58), typeof callback) === 'function') {
                __block_UoZ4jm(21);
                function timeoutDone() {
                    __block_UoZ4jm(22);
                    {
                        __statement_SCul9N(59);
                        var val;
                    }
                    try {
                        __block_UoZ4jm(23);
                        {
                            __statement_SCul9N(60);
                            val = (__expression_G8YRdZ(61), callback(promiseState.value));
                        }
                    } catch (ex) {
                        __block_UoZ4jm(24);
                        {
                            __statement_SCul9N(62);
                            __expression_G8YRdZ(63), reject(ex);
                        }
                        return __expression_G8YRdZ(64), (__expression_G8YRdZ(65), next(true));
                    }
                    {
                        __statement_SCul9N(66);
                        __expression_G8YRdZ(67), resolve(val);
                    }
                    {
                        __statement_SCul9N(68);
                        __expression_G8YRdZ(69), next(true);
                    }
                }
                if (__expression_G8YRdZ(70), skipTimeout) {
                    __block_UoZ4jm(25);
                    {
                        __statement_SCul9N(71);
                        __expression_G8YRdZ(72), timeoutDone();
                    }
                } else {
                    __block_UoZ4jm(26);
                    {
                        __statement_SCul9N(73);
                        __expression_G8YRdZ(74), nextTick(timeoutDone);
                    }
                }
            } else if (promiseState.isFulfilled) {
                __block_UoZ4jm(27);
                {
                    __statement_SCul9N(75);
                    __expression_G8YRdZ(76), resolve(promiseState.value);
                }
                {
                    __statement_SCul9N(77);
                    __expression_G8YRdZ(78), next(skipTimeout);
                }
            } else {
                __block_UoZ4jm(28);
                {
                    __statement_SCul9N(79);
                    __expression_G8YRdZ(80), reject(promiseState.value);
                }
                {
                    __statement_SCul9N(81);
                    __expression_G8YRdZ(82), next(skipTimeout);
                }
            }
        }
        {
            __statement_SCul9N(83);
            __extro_$SX98G(84, __intro_xH$3OO(84, promiseState.waiting).push(done));
        }
        if (__expression_G8YRdZ(85), promiseState.isSettled && (__expression_G8YRdZ(86), !promiseState.running)) {
            __block_UoZ4jm(29);
            {
                __statement_SCul9N(87);
                __expression_G8YRdZ(88), processQueue(promiseState);
            }
        }
    });
}
function processQueue(promiseState) {
    __block_UoZ4jm(30);
    function next(skipTimeout) {
        __block_UoZ4jm(31);
        if (promiseState.waiting.length) {
            __block_UoZ4jm(32);
            {
                __statement_SCul9N(89);
                promiseState.running = true;
            }
            {
                __statement_SCul9N(90);
                __expression_G8YRdZ(91), __extro_$SX98G(92, __intro_xH$3OO(92, promiseState.waiting).shift())(next, skipTimeout);
            }
        } else {
            __block_UoZ4jm(33);
            {
                __statement_SCul9N(93);
                promiseState.running = false;
            }
        }
    }
    {
        __statement_SCul9N(94);
        __expression_G8YRdZ(95), next(false);
    }
}
function settle(promiseState, isFulfilled, value) {
    __block_UoZ4jm(34);
    if (promiseState.isSettled) {
        __block_UoZ4jm(35);
        return __expression_G8YRdZ(96);
    }
    {
        __statement_SCul9N(97);
        promiseState.isResolved = promiseState.isSettled = true;
    }
    {
        __statement_SCul9N(98);
        promiseState.value = value;
    }
    {
        __statement_SCul9N(99);
        promiseState.isFulfilled = isFulfilled;
    }
    {
        __statement_SCul9N(100);
        __expression_G8YRdZ(101), processQueue(promiseState);
    }
}
function assimilate(promiseState, thenable) {
    __block_UoZ4jm(36);
    try {
        __block_UoZ4jm(37);
        {
            __statement_SCul9N(102);
            promiseState.isResolved = true;
        }
        {
            __statement_SCul9N(103);
            __extro_$SX98G(104, __intro_xH$3OO(104, thenable).then(function (res) {
                __block_UoZ4jm(38);
                if (__expression_G8YRdZ(105), isPromise(res)) {
                    __block_UoZ4jm(39);
                    {
                        __statement_SCul9N(106);
                        __expression_G8YRdZ(107), assimilate(promiseState, res);
                    }
                } else {
                    __block_UoZ4jm(40);
                    {
                        __statement_SCul9N(108);
                        __expression_G8YRdZ(109), settle(promiseState, true, res);
                    }
                }
            }, function (err) {
                __block_UoZ4jm(41);
                {
                    __statement_SCul9N(110);
                    __expression_G8YRdZ(111), settle(promiseState, false, err);
                }
            }));
        }
    } catch (ex) {
        __block_UoZ4jm(42);
        {
            __statement_SCul9N(112);
            __expression_G8YRdZ(113), settle(promiseState, false, ex);
        }
    }
}
{
    __statement_SCul9N(114);
    Promise.use = function (extension) {
        __block_UoZ4jm(43);
        {
            __statement_SCul9N(115);
            __extro_$SX98G(116, __intro_xH$3OO(116, extensions).push(extension));
        }
    };
}
function deprecate(method, name, alternative) {
    __block_UoZ4jm(44);
    return __expression_G8YRdZ(117), function () {
        __block_UoZ4jm(45);
        {
            __statement_SCul9N(118);
            var err = new Error((__expression_G8YRdZ(119), (__expression_G8YRdZ(120), (__expression_G8YRdZ(121), name) + ' is deprecated use ') + (__expression_G8YRdZ(122), alternative)));
        }
        if (__expression_G8YRdZ(123), (__expression_G8YRdZ(124), (__expression_G8YRdZ(125), (__expression_G8YRdZ(126), typeof console) !== 'undefined') && (__expression_G8YRdZ(127), console)) && (__expression_G8YRdZ(128), (__expression_G8YRdZ(129), typeof console.warn) === 'function')) {
            __block_UoZ4jm(46);
            {
                __statement_SCul9N(130);
                __extro_$SX98G(131, __intro_xH$3OO(131, console).warn((__expression_G8YRdZ(132), (__expression_G8YRdZ(133), (__expression_G8YRdZ(134), name) + ' is deprecated use ') + (__expression_G8YRdZ(135), alternative))));
            }
            if (err.stack) {
                __block_UoZ4jm(47);
                {
                    __statement_SCul9N(136);
                    __extro_$SX98G(137, __intro_xH$3OO(137, console).warn(err.stack));
                }
            }
        } else {
            __block_UoZ4jm(48);
            {
                __statement_SCul9N(138);
                __expression_G8YRdZ(139), nextTick(function () {
                    __block_UoZ4jm(49);
                    {
                        __statement_SCul9N(140);
                        throw err;
                    }
                });
            }
        }
        {
            __statement_SCul9N(141);
            __extro_$SX98G(142, __intro_xH$3OO(142, method).apply(this, arguments));
        }
    };
}
function defer() {
    __block_UoZ4jm(50);
    {
        __statement_SCul9N(143);
        var err = new Error('promise.defer() is deprecated');
    }
    if (__expression_G8YRdZ(144), (__expression_G8YRdZ(145), (__expression_G8YRdZ(146), (__expression_G8YRdZ(147), typeof console) !== 'undefined') && (__expression_G8YRdZ(148), console)) && (__expression_G8YRdZ(149), (__expression_G8YRdZ(150), typeof console.warn) === 'function')) {
        __block_UoZ4jm(51);
        {
            __statement_SCul9N(151);
            __extro_$SX98G(152, __intro_xH$3OO(152, console).warn('promise.defer() is deprecated'));
        }
        if (err.stack) {
            __block_UoZ4jm(52);
            {
                __statement_SCul9N(153);
                __extro_$SX98G(154, __intro_xH$3OO(154, console).warn(err.stack));
            }
        }
    } else {
        __block_UoZ4jm(53);
        {
            __statement_SCul9N(155);
            __expression_G8YRdZ(156), nextTick(function () {
                __block_UoZ4jm(54);
                {
                    __statement_SCul9N(157);
                    throw err;
                }
            });
        }
    }
    {
        __statement_SCul9N(158);
        var resolver;
    }
    {
        __statement_SCul9N(159);
        var promise = new Promise(function (res) {
                __block_UoZ4jm(55);
                {
                    __statement_SCul9N(160);
                    resolver = res;
                }
            });
    }
    return __expression_G8YRdZ(161), {
        resolver: resolver,
        promise: promise
    };
}