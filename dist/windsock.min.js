!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.windsock=r()}(this,function(){"use strict";function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(r,t){switch(t){case"empty":return 0===Object.keys(r).length;case"undefined":return"undefined"==typeof r;case"null":return null===r;default:return Object.prototype.toString.call(r)==="[object "+e(t)+"]"}}function t(e,c){var u,l=g.recursive(c),f=o(e);if(e._observers?c.observers.forEach(function(r){e._observers.exists(r)||e._observers.add(r)}):(u={_observers:{value:c,configurable:!1}},f.forEach(function(r){a(r,e[r],u)}),r(e,"array")?n(e,u):i(e,u),Object.defineProperties(e,u)),l.observers.length)for(var v=0,d=f.length;d>v;v++)s(e[f[v]])&&t(e[f[v]],l)}function i(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r.add={value:function(e,r){c(this,e,r)}},r["delete"]={value:function(e){u(this,e)}}}function n(e){for(var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],t=function(e,t){r[h[e]]={value:function(){l({args:Array.prototype.slice.call(arguments),method:h[e],target:this})}}},i=0,n=h.length;n>i;i++)t(i,n)}function s(e){return r(e,"array")||r(e,"object")}function o(e){return Object.getOwnPropertyNames(e).filter(function(r){return Object.getOwnPropertyDescriptor(e,r).configurable})}function a(e,r){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return i[e]={get:function(){return r},set:function(i){var n=new p({type:e,target:this,method:"set",oldValue:r,newValue:i,args:[]});this._observers.recursiveExists()&&s(i)&&t(i,g.recursive(this._observers)),v(this,r._observers),r=i,this._observers.dispatch(n)},enumerable:!0,configurable:!0},i}function c(e,i,n){if(!r(e[i],"undefined"))throw new Error("Failed to add "+i+" already defined");var o=new p({type:i,target:e,method:"add",oldValue:e[i],newValue:n,args:Array.prototype.slice.call(arguments,1)});e._observers.recursiveExists()&&s(n)&&t(n,g.recursive(e._observers)),Object.defineProperties(e,a(i,n)),e._observers.dispatch(o)}function u(e,t){if(r(e[t],"undefined"))throw new Error("Failed to delete "+t+" does not exist");var i=new p({type:t,target:e,method:"delete",oldValue:e[t],newValue:void 0,args:Array.prototype.slice.call(arguments,1)});v(e,e[t]._observers),delete e[t],e._observers.dispatch(i)}function l(e){var r=e.target,i=e.args,n=e.method,o=new p({type:void 0,target:r,method:n,oldValue:void 0,newValue:void 0,args:i});switch(n){case"fill":o.type=i.splice(1),o.oldValue=r.slice(i[1],i[2]);break;case"pop":o.type=r.length-1,o.oldValue=r.slice(r.length-1);break;case"push":o.type=r.length,o.newValue=i;break;case"shift":o.type=0,o.oldValue=r.slice(0,1);break;case"unshift":o.type=0,o.newValue=i;break;case"splice":o.type=i[0],i[1]&&(o.oldValue=r.slice(i[0],i[0]+i[1]))}r._observers.recursiveExists()&&o.newValue.forEach(function(e){s(e)&&t(e,g.recursive(r._observers))}),o.oldValue&&o.oldValue.forEach(function(e){v(r,e._observers)}),Array.prototype[n].apply(r,e.args),r._observers.dispatch(o)}function f(e,r){o(e).forEach(function(t){f(e[t],r),e[t]._observers&&e[t]._observers.remove(r)})}function v(e,r){r&&e._observers.recursive().forEach(function(e){r.remove(e)})}var d={};d.classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},d.createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,t,i){return t&&e(r.prototype,t),i&&e(r,i),r}}();var h=["fill","pop","push","shift","splice","unshift"],b=function(){function e(t){if(d.classCallCheck(this,e),r(t,"undefined"))throw new Error("Failed to instantiate missing callback");if(!r(t,"function"))throw new Error("Invalid callback specified");this.callback=t,this._target=void 0,this._config=void 0}return d.createClass(e,[{key:"observe",value:function(e){var i,n=arguments.length<=1||void 0===arguments[1]?{recursive:!1}:arguments[1];if(!s(e))throw new Error("Failed to observe not a valid target");if(r(n.recursive,"undefined"))throw new Error("Invalid config specified");i=new g,i.add(this),this._target=e,this._config=n,t(e,i)}},{key:"disconnect",value:function(){this._target&&(this._config.recursive&&f(this._target,this),this._target._observers.remove(this)),this._target=void 0,this._config=void 0}}]),e}(),p=function w(e){d.classCallCheck(this,w),this.type=e.type,this.target=e.target,this.method=e.method,this.args=e.args,this.newValue=e.newValue,this.oldValue=e.oldValue},g=function(){function e(){var r=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];d.classCallCheck(this,e),this.observers=r}return d.createClass(e,[{key:"dispatch",value:function(e){if(!e instanceof p)throw new Error("Invalid record specified");this.observers.forEach(function(r){r.callback(e)})}},{key:"exists",value:function(e){return-1!==this.observers.indexOf(e)}},{key:"add",value:function(e){return this.observers.push(e)}},{key:"remove",value:function(e){var r=this.observers.indexOf(e);return-1!==r&&this.observers.splice(r,1),r}},{key:"recursive",value:function(){return this.observers.filter(function(e){return e._config.recursive})}},{key:"recursiveExists",value:function(){for(var e=0,r=this.observers.length;r>e;e++)if(this.observers[e]._config.recursive)return!0;return!1}}],[{key:"recursive",value:function(r){if(!r instanceof e)throw new Error("Invalid list specified");return new e(r.recursive())}}]),e}(),y={version:"0.1.14",Observer:b};return y});